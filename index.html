<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dinesh ‚Äî Restaurant POS</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <link href="style.css" rel="stylesheet" />
</head>
<body>

  <!-- Sidebar Navigation -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="brand-logo">
        <span class="logo-icon">üçõ</span>
        <div>
          <div class="brand-name">Dinesh</div>
          <div class="brand-tagline">Restaurant POS</div>
        </div>
      </div>
    </div>
    <ul class="sidebar-nav">
      <li><a href="#" class="nav-link active" data-page="menu"><i class="fa fa-utensils"></i><span>Menu</span></a></li>
      <li><a href="#" class="nav-link" data-page="cart"><i class="fa fa-shopping-cart"></i><span>Cart</span><span class="cart-badge" id="cartBadge">0</span></a></li>
      <li><a href="#" class="nav-link" data-page="reports"><i class="fa fa-chart-bar"></i><span>Reports</span></a></li>
      <li><a href="#" class="nav-link" data-page="manage"><i class="fa fa-cog"></i><span>Manage Menus</span></a></li>
      <li><a href="#" class="nav-link" data-page="settings"><i class="fa fa-sliders"></i><span>Settings</span></a></li>
    </ul>
    <div class="sidebar-footer">
      <div class="restaurant-info" id="restaurantInfo"></div>
    </div>
  </nav>

  <!-- Mobile Top Bar -->
  <header class="mobile-header d-lg-none">
    <button class="hamburger" id="hamburger"><i class="fa fa-bars"></i></button>
    <span class="mobile-brand">Dinesh</span>
    <div class="d-flex align-items-center gap-2">
      <button class="icon-btn" onclick="navigateTo('settings')" title="Settings"><i class="fa fa-sliders" style="color:var(--text-light)"></i></button>
      <button class="cart-btn-mobile" data-page="cart"><i class="fa fa-shopping-cart"></i><span class="cart-badge" id="cartBadgeMobile">0</span></button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content" id="mainContent">

    <!-- ===== MENU PAGE ===== -->
    <section class="page active" id="page-menu">
      <div class="page-header">
        <h1 class="page-title">Today's <em>Menu</em></h1>
        <div class="search-bar">
          <i class="fa fa-search"></i>
          <input type="text" id="menuSearch" placeholder="Search dishes‚Ä¶" />
        </div>
      </div>
      <div class="menu-grid" id="menuGrid"></div>
    </section>

    <!-- ===== CART PAGE ===== -->
    <section class="page" id="page-cart">
      <div class="page-header">
        <h1 class="page-title">Your <em>Order</em></h1>
      </div>
      <div class="cart-layout">
        <div class="cart-items-wrap" id="cartItemsWrap">
          <div class="empty-cart-msg" id="emptyCartMsg">
            <i class="fa fa-bowl-rice fa-3x"></i>
            <p>Your cart is empty.<br/>Head to the menu to add items.</p>
          </div>
          <div id="cartItems"></div>
        </div>
        <div class="cart-summary-card" id="cartSummaryCard">
          <h3>Bill Summary</h3>
          <div class="summary-row"><span>Subtotal</span><span id="subtotal">‚Çπ0.00</span></div>
          <div class="summary-row" id="taxRow">
            <span class="d-flex align-items-center gap-2">
              <span id="taxLabel">Tax (5%)</span>
              <div class="form-check form-switch mb-0 ms-1" title="Enable / disable tax">
                <input class="form-check-input" type="checkbox" id="taxToggle" checked style="cursor:pointer;width:2em;height:1.1em" />
              </div>
            </span>
            <span id="taxAmount">‚Çπ0.00</span>
          </div>
          <div class="summary-row total-row"><span>Total</span><span id="totalAmount">‚Çπ0.00</span></div>
          <div class="cart-actions mt-3">
            <button class="btn btn-outline-danger me-2" id="clearCartBtn"><i class="fa fa-trash me-1"></i>Clear</button>
            <button class="btn btn-primary flex-grow-1" id="checkoutBtn"><i class="fa fa-qrcode me-1"></i>Checkout</button>
          </div>
          <div class="mt-3">
            <label class="form-label-sm">Table No.</label>
            <input type="number" id="tableNumber" class="form-control form-control-sm" placeholder="e.g. 5" min="1" />
          </div>
          <div class="mt-2">
            <label class="form-label-sm">Customer Name</label>
            <input type="text" id="customerName" class="form-control form-control-sm" placeholder="Optional ‚Äî creates account" />
          </div>
        </div>
      </div>
    </section>

    <!-- ===== REPORTS PAGE ===== -->
    <section class="page" id="page-reports">
      <div class="page-header flex-wrap gap-2">
        <h1 class="page-title">Sales <em>Reports</em></h1>
        <div class="report-tabs" id="reportTabs">
          <button class="report-tab active" data-period="daily">Daily</button>
          <button class="report-tab" data-period="weekly">Weekly</button>
          <button class="report-tab" data-period="monthly">Monthly</button>
          <button class="report-tab" data-period="customers"><i class="fa fa-users me-1"></i>Customers</button>
        </div>
      </div>
      <div class="report-stats" id="reportStats"></div>
      <div class="report-table-wrap">
        <h4 class="section-label">Item-wise Sales</h4>
        <div id="reportTable"></div>
      </div>
      <div class="bills-list-wrap mt-4">
        <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
          <h4 class="section-label mb-0">All Bills</h4>
          <span class="text-muted" style="font-size:0.82rem"><i class="fa fa-sort-amount-down me-1"></i>Newest first</span>
        </div>
        <div id="billsList"></div>
      </div>
      <div id="customerAccountsSection" style="display:none">
        <div class="bills-list-wrap">
          <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
            <h4 class="section-label mb-0"><i class="fa fa-users me-2 text-muted"></i>Customer Accounts</h4>
            <span class="text-muted" style="font-size:0.82rem">Outstanding balances shown first</span>
          </div>
          <div id="customerAccountsList"></div>
        </div>
      </div>
    </section>

    <!-- ===== MANAGE MENUS PAGE ===== -->
    <section class="page" id="page-manage">
      <div class="page-header">
        <h1 class="page-title">Manage <em>Menus</em></h1>
      </div>
      <div class="manage-layout">
        <div class="manage-form-card" id="manageFormCard">
          <h4 id="formTitle">Add New Item</h4>
          <form id="menuForm">
            <input type="hidden" id="editId" />
            <div class="mb-3">
              <label class="form-label">Item Name</label>
              <input type="text" class="form-control" id="itemName" required placeholder="e.g. Masala Dosa" />
            </div>
            <div class="mb-3">
              <label class="form-label">Price (‚Çπ)</label>
              <input type="number" class="form-control" id="itemPrice" required min="1" placeholder="e.g. 60" />
            </div>
            <div class="mb-3">
              <label class="form-label">Category</label>
              <select class="form-select" id="itemCategory">
                <option value="Breakfast">Breakfast</option>
                <option value="Lunch">Lunch</option>
                <option value="Snacks">Snacks</option>
                <option value="Beverages">Beverages</option>
                <option value="Dinner">Dinner</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Emoji Icon</label>
              <input type="text" class="form-control" id="itemEmoji" placeholder="üçõ" maxlength="2" />
            </div>
            <div class="mb-3">
              <label class="form-label">Total Stock <span class="text-muted" style="font-size:0.78rem">(blank = unlimited)</span></label>
              <input type="number" class="form-control" id="itemStock" min="0" placeholder="e.g. 50" />
              <div class="form-text">Set to 0 to mark as Out of Stock.</div>
            </div>
            <div class="mb-3">
              <label class="form-label">Image (optional)</label>
              <input type="file" class="form-control" id="itemImage" accept="image/*" />
              <div id="imagePreview" class="image-preview-wrap mt-2"></div>
            </div>
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary flex-grow-1" id="submitBtn">Add Item</button>
              <button type="button" class="btn btn-outline-secondary" id="cancelEditBtn" style="display:none">Cancel</button>
            </div>
          </form>
        </div>
        <div class="manage-list-wrap">
          <div id="manageList"></div>
        </div>
      </div>
    </section>

    <!-- ===== SETTINGS PAGE ===== -->
    <section class="page" id="page-settings">
      <div class="page-header">
        <h1 class="page-title">Restaurant <em>Settings</em></h1>
      </div>

      <form id="settingsForm" autocomplete="off">
        <div class="settings-layout">

          <!-- LEFT COLUMN -->
          <div class="settings-col">

            <!-- Restaurant Info Card -->
            <div class="settings-card">
              <div class="settings-card-header">
                <i class="fa fa-store"></i>
                <span>Restaurant Info</span>
              </div>
              <div class="settings-card-body">
                <div class="mb-3">
                  <label class="form-label">Restaurant Name <span class="required-star">*</span></label>
                  <div class="input-with-icon">
                    <i class="fa fa-utensils input-icon"></i>
                    <input type="text" class="form-control ps-5" id="setRestName" required placeholder="e.g. Dinesh's Restaurant" />
                  </div>
                </div>
                <div class="mb-3">
                  <label class="form-label">Tagline</label>
                  <div class="input-with-icon">
                    <i class="fa fa-quote-left input-icon"></i>
                    <input type="text" class="form-control ps-5" id="setTagline" placeholder="e.g. Authentic Indian Cuisine" />
                  </div>
                </div>
                <div class="mb-3">
                  <label class="form-label">Logo / Emoji</label>
                  <div class="input-with-icon">
                    <i class="fa fa-star input-icon"></i>
                    <input type="text" class="form-control ps-5" id="setLogo" placeholder="üçõ" maxlength="2" style="font-size:1.4rem" />
                  </div>
                </div>
                <div class="mb-3">
                  <label class="form-label">Address</label>
                  <div class="input-with-icon">
                    <i class="fa fa-location-dot input-icon" style="top:14px"></i>
                    <textarea class="form-control ps-5" id="setAddress" rows="2" placeholder="2/73, NKS Nagar, Bodipatti, Udumalaipettai - 642154."></textarea>
                  </div>
                </div>
                <div class="mb-0">
                  <label class="form-label">Mobile Number</label>
                  <div class="input-with-icon">
                    <i class="fa fa-phone input-icon"></i>
                    <input type="tel" class="form-control ps-5" id="setPhone" placeholder="e.g. +91 9500558896" />
                  </div>
                </div>
              </div>
            </div>

            <!-- Tax Settings Card -->
            <div class="settings-card">
              <div class="settings-card-header">
                <i class="fa fa-percent"></i>
                <span>Tax Settings</span>
              </div>
              <div class="settings-card-body">
                <div class="tax-toggle-row mb-3">
                  <div>
                    <div class="fw-600" style="font-size:0.95rem">Enable Tax</div>
                    <div style="font-size:0.78rem;color:var(--text-muted)">Toggle to include / exclude tax from all bills</div>
                  </div>
                  <div class="form-check form-switch mb-0">
                    <input class="form-check-input settings-toggle" type="checkbox" id="setTaxEnabled" checked />
                  </div>
                </div>
                <div id="taxRateWrap">
                  <label class="form-label">Tax Rate (%)</label>
                  <div class="tax-rate-group">
                    <div class="tax-preset-btns">
                      <button type="button" class="tax-preset" data-rate="5">5%</button>
                      <button type="button" class="tax-preset" data-rate="8">8%</button>
                      <button type="button" class="tax-preset" data-rate="12">12%</button>
                      <button type="button" class="tax-preset" data-rate="18">18%</button>
                    </div>
                    <div class="input-group mt-2">
                      <input type="number" class="form-control" id="setTaxRate" min="0" max="100" step="0.1" placeholder="Custom %" />
                      <span class="input-group-text fw-600">%</span>
                    </div>
                    <div class="form-text mt-1">Click a preset or enter a custom rate. Changes apply to all future orders.</div>
                  </div>
                </div>
                <div id="taxDisabledNote" class="tax-disabled-note" style="display:none">
                  <i class="fa fa-circle-info me-2"></i>Tax is currently disabled. All orders will be billed without tax.
                </div>
              </div>
            </div>
          </div>

          <!-- RIGHT COLUMN -->
          <div class="settings-col">

            <!-- Payment / QR Card -->
            <div class="settings-card">
              <div class="settings-card-header">
                <i class="fa fa-qrcode"></i>
                <span>Payment & QR Code</span>
              </div>
              <div class="settings-card-body">
                <div class="mb-3">
                  <label class="form-label">UPI ID</label>
                  <div class="input-with-icon">
                    <i class="fa fa-indian-rupee-sign input-icon"></i>
                    <input type="text" class="form-control ps-5" id="setUpiId" placeholder="e.g. yourname@upi" />
                  </div>
                  <div class="form-text">Used to generate payment QR code automatically from UPI ID.</div>
                </div>

                <hr class="settings-divider" />

                <div class="mb-1">
                  <label class="form-label">Upload Payment QR Image</label>
                  <div class="form-text mb-2">Upload a pre-made QR image (e.g. from your bank app). This will be shown in the checkout screen instead of the auto-generated QR.</div>
                </div>

                <!-- Hidden file input -->
                <input type="file" id="qrImageInput" accept="image/*" class="d-none" />

                <!-- QR Preview Area -->
                <div id="qrImagePreview" class="qr-upload-zone">
                  <!-- Rendered by JS -->
                </div>
              </div>
            </div>

            <!-- Live Preview Card -->
            <div class="settings-card">
              <div class="settings-card-header">
                <i class="fa fa-eye"></i>
                <span>Live Preview</span>
              </div>
              <div class="settings-card-body">
                <div class="settings-preview-receipt" id="settingsPreviewReceipt">
                  <!-- Rendered by JS -->
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- Save / Reset Bar -->
        <div class="settings-save-bar">
          <button type="button" class="btn btn-outline-danger" onclick="resetSettingsToDefault()">
            <i class="fa fa-rotate-left me-1"></i>Reset to Default
          </button>
          <button type="submit" class="btn btn-primary px-4">
            <i class="fa fa-save me-1"></i>Save Settings
          </button>
        </div>
      </form>
    </section>

  </main>

  <!-- ===== QR / Checkout Modal ===== -->
  <div class="modal fade" id="checkoutModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content checkout-modal">
        <div class="modal-header border-0">
          <h5 class="modal-title" style="font-family:'Playfair Display',serif">Complete Payment</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="checkout-layout">
            <div class="qr-section text-center">
              <div class="qr-label">Scan to Pay</div>
              <div id="qrCode"></div>
              <div class="upi-id mt-2" id="upiDisplay"></div>
              <div class="mt-3">
                <button class="btn btn-sm btn-outline-warning w-100" id="partPayToggle">
                  <i class="fa fa-money-bill-wave me-1"></i>Part Payment
                </button>
                <div id="partPayWrap" class="d-none mt-2">
                  <div class="input-group input-group-sm">
                    <span class="input-group-text">‚Çπ</span>
                    <input type="number" class="form-control" id="partPaymentAmt" placeholder="Amount paid now" min="1" step="0.01" />
                  </div>
                  <button class="btn btn-warning btn-sm w-100 mt-2" id="confirmPartPayBtn">
                    <i class="fa fa-check me-1"></i>Confirm Part Payment
                  </button>
                </div>
              </div>
            </div>
            <div class="bill-preview" id="billPreview"></div>
          </div>
        </div>
        <div class="modal-footer border-0 flex-wrap gap-2">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
          <button class="btn btn-primary" id="printBillBtn"><i class="fa fa-print me-1"></i>Print</button>
          <button class="btn btn-success" id="confirmPaymentBtn"><i class="fa fa-check me-1"></i>Full Payment</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== View Single Bill Modal ===== -->
  <div class="modal fade" id="viewBillModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" style="max-width:480px">
      <div class="modal-content" style="background:var(--cream);border-radius:20px;border:none">
        <div class="modal-header border-0">
          <h5 class="modal-title" style="font-family:'Playfair Display',serif">Bill Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="savedBillContent" style="max-height:55vh;overflow-y:auto"></div>
        <div class="modal-body pt-0" id="addPaymentWrap" style="display:none"></div>
        <div class="modal-footer border-0 flex-wrap gap-2">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
          <button class="btn btn-outline-warning" id="markFullPaidBtn" style="display:none"><i class="fa fa-check-double me-1"></i>Mark Fully Paid</button>
          <button class="btn btn-outline-success" id="savedBillDownloadBtn"><i class="fa fa-download me-1"></i>Download</button>
          <button class="btn btn-primary" id="savedBillPrintBtn"><i class="fa fa-print me-1"></i>Print</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Customer Account Modal ===== -->
  <div class="modal fade" id="customerAccountModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content" style="border-radius:20px;border:none">
        <div class="modal-header" style="background:var(--dark);color:white;border-radius:20px 20px 0 0;border:none">
          <div>
            <h5 class="modal-title mb-0" style="font-family:'Playfair Display',serif">
              <span id="custAccName"></span>'s Account
            </h5>
            <div style="font-size:0.78rem;opacity:0.6;margin-top:2px">Full Account Statement</div>
          </div>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" style="background:var(--cream)">
          <div id="custAccStats"></div>
          <h6 class="section-label mb-3">Order History</h6>
          <div id="custAccOrders"></div>
        </div>
        <div class="modal-footer flex-wrap gap-2" style="background:var(--cream);border-top:1px solid #EEE;border-radius:0 0 20px 20px">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
          <button class="btn btn-outline-success" id="custAccDownloadBtn"><i class="fa fa-download me-1"></i>Download Statement</button>
          <button class="btn btn-outline-secondary" id="custAccPrintBtn"><i class="fa fa-print me-1"></i>Print Statement</button>
          <button class="btn btn-success" id="settleFullBtn" style="display:none"><i class="fa fa-check-double me-1"></i>Settle Full Account</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Print Area (hidden) -->
  <div id="printArea" style="display:none"></div>

  <!-- Mobile sidebar overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="utils.js"></script>
  <script src="menu.js"></script>
  <script src="cart.js"></script>
  <script src="reports.js"></script>
  <script src="manage.js"></script>
  <script src="settings.js"></script>
  <script src="app.js"></script>
</body>
</html>
